bootJar {
	enabled = true
	mainClassName = 'com.zions.web.monitor.CliWebMonitor'
	archiveName = "zions-web-monitoring-${version}.jar"
	//version =  null
}

sourceSets {
    integrationTest {
        groovy {
            compileClasspath += main.output + test.output
            runtimeClasspath += main.output + test.output
            srcDir file('src/integration-test/groovy')
        }
        resources.srcDir file('src/integration-test/resources')
    }
}

configurations {
    integrationTestCompile.extendsFrom testCompile
    integrationTestRuntime.extendsFrom testRuntime
}
dependencies {
	compile project(':zions-ext-services')
	compile project(':zions-vsts-services')
	compile project(':zions-ccm-client-services')
	compile project(':zions-common')
	compile project(':zions-common-data')
	compile group: 'org.seleniumhq.selenium', name: 'selenium-java', version: '3.14.0'
	integrationTestCompile(
			'org.springframework.boot:spring-boot-starter-test',
			'org.springframework:spring-mock:2.0.8',
			'cglib:cglib-nodep:3.1',
			'com.athaydes:spock-reports:1.6.2',
			'org.objenesis:objenesis:2.4',
			'org.codehaus.groovy:groovy-all:3.0.1',
			'org.spockframework:spock-core:2.0-M2-groovy-3.0',
			'org.spockframework:spock-spring:2.0-M2-groovy-3.0'
		)

}
task integrationTest(type: Test) {
    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath
    systemProperty "spring.profiles.active", 'integration-test'
    
}


//integrationTest.mustRunAfter test

task updateBatJarVersion(type: Copy) {
	from('batch') {
		include( '**/*.bat' )
	}
	into("${buildDir}/batch_out")
	
	filter {
		String line -> line.replaceAll('zions-ext-cli.jar', "zions-ext-cli-${version}.jar")
	}
}