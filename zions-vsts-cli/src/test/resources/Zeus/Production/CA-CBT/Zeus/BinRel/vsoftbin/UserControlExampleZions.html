<html>
<head></head>
<body onload="Load();" onunload="Unload();">
<form id="Form1">
<table width="100%">
  <tr>
    <td valign="top">
      <input type="button" onclick="StartTran();" name="btnStartTran" value="Start Tran" />
      <input type="button" onclick="GetTran();" name="btnGetTran" value="Get Tran" />
      <input type="button" onclick="GetTranEx();" name="btnGetTranEx" value="Get Tran Ex" />
      <p></p>
      <input type="button" onclick="RemoveItem();" name="btnRemoveItem" value="Remove Item" />
      <input type="button" onclick="Transmit();" name="btnTransmit" value="Transmit" />
      <input type="button" onclick="DeleteTran();" name="btnDeleteTran" value="Delete Tran" />
      <hr/>
      <input type="button" onclick="CanDelete();" name="btnCanDelete" value="Can Delete?" />
      <input type="button" onclick="ServerDelete();" name="btnServerDelete" value="Server Delete" />
      <input type="button" onclick="ReleaseLock();" name="btnReleaseLock" value="Release Lock" />
      <p></p>
      <input type="button" onclick="ViewServerTran();" name="btnViewServerTran" value="View Server Tran" />
    </td>
    <td valign="top">
      <table style="border-style:solid;border-color:Gray;border-width:thin;border-collapse:collapse;margin:1,1,1,1" cellpadding="1" width="400">
        <tr><td style="font-size: x-small;font-family:Arial;color:Blue" colspan="2"><i>Start Parameters</i></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Date:</td><td><input type="text" id="txtDate" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Teller ID:</td><td><input type="text" id="txtTellerId" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Lead Account:</td><td><input type="text" id="txtCreditAccount" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Transaction Type:</td><td><input type="text" id="txtTranType" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Bond Mode:</td><td><select id="ddlBondMode"><option value="0">None</option><option value="1">Inquiry</option><option value="2">Redeem</option></select></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Item Limit:</td><td><input type="text" id="txtItemLimit" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Headless:</td><td><input type="checkbox" id="cbHeadless" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Transaction ID:</td><td><input type="text" id="txtTranId" name="txtTranId" value="" /></td></tr>
        <tr><td style="font-size: x-small;font-family:Arial">Session ID:</td><td><input type="text" id="txtSessionId" name="txtSessionId" value="" /></td></tr>
      </table>
      <table>
        <tr><td style="font-size: x-small;font-family:Arial">Return Value:</td><td><input type="text" id="txtReturnValue" name="txtReturnValue" value="" /></td></tr>
      </table>
    </td>
    <td valign="top">
      <object id="vsoftTeller" classid="clsid:75ABFAD1-3181-33FE-8694-F1A18D02B942" style="width: 76px; height: 60px" ></object>
    </td>
  </tr>
</table>
<hr/>
<table>
  <tr><td><input type="button" onclick="ClearTextArea();" name="btnClearBox" value="Clear" /></td></tr>
  <tr><td width="500">Returned List</td></tr>
</table>
<textarea id="txtCallback" style="width: 100%; height: 500px"></textarea>

<script type="text/javascript">

var vsoftTeller = document.getElementById('vsoftTeller');
var transId;
var seqNum;

function Load()
{
    Load_Date();
    Load_TellerId();
    Load_CreditAccount();
    Load_TranType();
    Load_ItemLimit();
}

function Unload()
{
    var err;
    vsoftTeller.TCShutDown(err);
}

function StartTran()
{
    ClearTextArea();
    var date = RunTeller_GetValue('txtDate');
    var teller = RunTeller_GetValue('txtTellerId');
    var account = RunTeller_GetValue('txtCreditAccount');
    var preTranId = RunTeller_GetValue('txtTranId');
    var preSessionId = RunTeller_GetValue('txtSessionId');
    var tranType = RunTeller_GetValue('txtTranType');
    var bm = document.getElementById('ddlBondMode');
    var bondMode = bm.options[bm.selectedIndex].value;
    var itemLimit = RunTeller_GetValue('txtItemLimit');
    var headless = document.getElementById("cbHeadless").checked;
    var instId = 1;
    var branchNumber = '1';
    var workstationId = 'TestStation';
    var xmlBondItems = '';
    var response = vsoftTeller.TCStartEditTranCOM(date, instId, branchNumber, teller, workstationId, preTranId, preSessionId, account, tranType, bondMode, xmlBondItems, itemLimit, headless);
    //transId = vsoftTeller.GetTransactionId();
    SetReturnValue(response.nReturnCode);
    SetTransactionId(response.strTransactionId);
    SetSessionId(response.strSessionId);
    if (response.nReturnCode == 0)
    {
        alert('StartTran Successful');
    }
    else
    {
        alert('StartTran Failed')
    }
}

function GetTran()
{
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var tranType = RunTeller_GetValue('txtTranType');
    var bm = document.getElementById('ddlBondMode');
    var bondMode = bm.options[bm.selectedIndex].value;
    var response = vsoftTeller.TCGetTranCOM(teller, sessionId, tranType, bondMode);
    seqNum = vsoftTeller.GetLastItemSequenceNumber();
    SetReturnValue(response.nReturnCode);
    FillTextArea('Total Amount: $' + response.dTotalAmount);
    if (response.nReturnCode == 0)
    {
        alert('GetTran Successful');
    }
    else
    {
        alert('GetTran Failed')
    }
}

function GetTranEx()
{
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var tranType = RunTeller_GetValue('txtTranType');
    var bm = document.getElementById('ddlBondMode');
    var bondMode = bm.options[bm.selectedIndex].value;
    var response = vsoftTeller.TCGetTranExCOM(teller, sessionId, tranType, bondMode);
    seqNum = vsoftTeller.GetLastItemSequenceNumber();
    SetReturnValue(response.nReturnCode);
    FillTextArea(response.xmlString);
    if (response.nReturnCode == 0)
    {
        alert('GetTranEx Successful');
    }
    else
    {
        alert('GetTranEx Failed')
    }
}

function Transmit()
{
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var journalNumber = "123456789";
    var partialFlag = false;
    var xmlVirtualCredits = "<?xml version=\"1.0\" encoding=\"utf-8\"?><VirtualItemList><Items><VCVD><DocId>0</DocId><InstId>1</InstId><CrInd>true</CrInd><Serial>101</Serial><Routing>061000227</Routing><Account>101012345678</Account><TranCode></TranCode><Amount>100.00</Amount><Description>Test Deposit Ticket</Description><UserField1>Cost Center: 777</UserField1></VCVD><VCVD><DocId>0</DocId><InstId>1</InstId><CrInd>true</CrInd><Serial></Serial><Routing>061000227</Routing><Account>202023456789</Account><TranCode>102</TranCode><Amount>50.00</Amount><Description>Second Virtual Credit</Description><UserField1>Cost Center: 777</UserField1></VCVD></Items></VirtualItemList>";
    var xmlVirtualDocs = "<?xml version=\"1.0\" encoding=\"utf-8\"?><VirtualItemList><Items><VCVD><DocId>1</DocId><Amount>10.00</Amount></VCVD><VCVD><DocId>0</DocId><InstId>1</InstId><CrInd>true</CrInd><Serial></Serial><Routing>323232223</Routing><Account>33333333333</Account><TranCode>103</TranCode><Amount>30.00</Amount><Description>Test Virtual Document</Description></VCVD></Items></VirtualItemList>";
    var response = vsoftTeller.TCTransmitCOM(teller, sessionId, xmlVirtualCredits, xmlVirtualDocs, journalNumber, partialFlag);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode == 0)
    {
        alert('Transmit Successful');
    }
    else
    {
        alert('Transmit Failed')
    }
}

function RemoveItem()
{
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.TCRemoveItemCOM(teller, sessionId, seqNum);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode == 0)
    {
        alert('The last item in the transaction was removed successfully');
    }
    else
    {
        alert('RemoveItem Failed')
    }
}

function DeleteTran()
{
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.TCDeleteTranCOM(teller, sessionId);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode == 0)
    {
        alert('Transaction deleted successfully');
    }
    else
    {
        alert('DeleteTran Failed')
    }
}

function CanDelete()
{
    var instId = 1;
    var workstationId = '';
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.CanDeleteTransactionCOM(instId, teller, workstationId, sessionId);
    SetReturnValue('Can Delete ? ' + response.bCanDelete.toString());
    if (response.nReturnCode == 0)
    {
        alert('CanDelete successfully');
    }
    else
    {
        alert('CanDelete Failed')
    }
}

function ServerDelete()
{
    var instId = 1;
    var workstationId = '';
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.ServerDeleteTransactionCOM(instId, teller, workstationId, sessionId);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode == 0)
    {
        alert('ServerDelete successfully');
    }
    else
    {
        alert('ServerDelete Failed')
    }
}

function ReleaseLock()
{
    var instId = 1;
    var workstationId = '';
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.ServerReleaseLockCOM(instId, teller, workstationId, sessionId);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode == 0)
    {
        alert('ReleaseLock successfully');
    }
    else
    {
        alert('ReleaseLock Failed')
    }
}

function ViewServerTran()
{
    var instId = 1;
    var workstationId = '';
    var teller = RunTeller_GetValue('txtTellerId');
    var sessionId = RunTeller_GetValue('txtSessionId');
    var response = vsoftTeller.GetSentTransactionViewCOM(instId, teller, workstationId, sessionId);
    SetReturnValue(response.nReturnCode);
    if (response.nReturnCode != 0)
    {
        alert('ViewServerTran Failed')
    }
}

function RunTeller_GetValue(id)
{
    var txt = document.getElementById(id);
    var val = txt.value;
    return val;
}

function Load_Date()
{
    var myDate = new Date();
    var txtDate = document.getElementById('txtDate');
    var dateString;
    if ((myDate.getMonth() + 1).toString().length == 1)
    {
        dateString = '0';
    }
    else
    {
        dateString = '';
    }
    dateString += (myDate.getMonth() + 1) + '/';
    if (myDate.getDate().toString().length == 1)
    {
        dateString += '0'
    }
    dateString += myDate.getDate() + '/' + myDate.getFullYear();
    txtDate.value = dateString;
}

function Load_TellerId()
{
    var tellerId = Math.floor(Math.random() * 10000);
    var txtTellerId = document.getElementById('txtTellerId');
    txtTellerId.value = tellerId;
}

function Load_CreditAccount()
{
    var account = Math.floor(Math.random() * 10000) + '0000' + Math.floor(Math.random() * 1000);
    var txtCreditAccount = document.getElementById('txtCreditAccount');
    txtCreditAccount.value = account;
}

function Load_TranType()
{
    var txtTranType = document.getElementById('txtTranType');
    txtTranType.value = '123456';
}

function Load_ItemLimit()
{
    var txtItemLimit = document.getElementById('txtItemLimit');
    txtItemLimit.value = '0';
}

function SetReturnValue(s)
{
    var mod = document.getElementById('txtReturnValue');
    mod.value = s;
}

function SetTransactionId(s)
{
    var mod = document.getElementById('txtTranId');
    mod.value = s;
}

function SetSessionId(s)
{
    var mod = document.getElementById('txtSessionId');
    mod.value = s;
}

function ClearTextArea()
{
    var txtCallback = document.getElementById('txtCallback');
    txtCallback.value = '';
}

function FillTextArea(s)
{
    var txtCallback = document.getElementById('txtCallback');
    txtCallback.value = txtCallback.value + s + '\r\n'
}

</script>
</form>
</body>
</html>
